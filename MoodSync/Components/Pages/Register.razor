@page "/register"
@using Microsoft.EntityFrameworkCore
@using MoodSync.Components.Layout
@using MoodSync.Data
@using MoodSync.Models
@inject ApplicationDbContext DbContext
@inject NavigationManager NavigationManager
@layout MainLayout

@code {
    private User newUser = new User();
    private string errorMessage;

    private async Task RegisterUser()
    {
        try
        {
            var existingUser = await DbContext.Users
                .FirstOrDefaultAsync(u => u.UserName == newUser.UserName);

            if (existingUser != null)
            {
                errorMessage = "Username already exists!";
                return;
            }

            DbContext.Users.Add(newUser);
            await DbContext.SaveChangesAsync();

            NavigationManager.NavigateTo("/login");
        }
        catch (Exception ex)
        {
            errorMessage = $"An error occurred: {ex.Message}";
        }
    }
}

 <div class="register-form">
    <h2>Register</h2>

    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="error-message">@errorMessage</div>
    }

    <input @bind="newUser.UserName" placeholder="Username" />
    <input @bind="newUser.Password" type="password" placeholder="Password" />
    <input @bind="newUser.Email" placeholder="Email" />
    <button @onclick="RegisterUser">Register</button>
</div>
